<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#ff7800 name=theme-color><meta content=#ffa348 media=(prefers-color-scheme:dark) name=theme-color><title>Lab 4: Motor Drivers and Open Loop Control - Home</title><link href="https://correial.github.io/Fast Robots/lab-4/" rel=canonical><link href=https://correial.github.io/favicon.png rel=icon type=image/png><link href=https://correial.github.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link title="Home - RSS Feed" href=https://correial.github.io/rss.xml rel=alternate type=application/rss+xml><link title="Home - Atom Feed" href=https://correial.github.io/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#ff7800}[data-theme=dark]{--accent-color:#ffa348}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#ffa348}}</style><link href=https://correial.github.io/style.css rel=stylesheet><link href=https://correial.github.io/fonts.css rel=stylesheet><link href=https://correial.github.io/katex.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=https://correial.github.io/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://correial.github.io/syntax-theme-dark.css rel=stylesheet><script defer src=https://correial.github.io/closable.js></script><script defer src=https://correial.github.io/copy-button.js></script><script defer src=https://correial.github.io/katex.min.js></script><script defer src=https://correial.github.io/auto-render.min.js></script><script defer src=https://correial.github.io/katex-init.js></script><script defer src=https://correial.github.io/fuse.js></script><script defer src=https://correial.github.io/search-fuse.js></script><script defer src=https://correial.github.io/theme-switcher.js></script><meta content=Home property=og:site_name><meta content="Lab 4: Motor Drivers and Open Loop Control - Home" property=og:title><meta content="https://correial.github.io/Fast Robots/lab-4/" property=og:url><meta property=og:description><meta content=https://correial.github.io/card.png property=og:image><meta content=en_US property=og:locale><body><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://correial.github.io> <i class=icon></i>Home</a><li class=divider><li><details class=closable><summary>Projects</summary> <ul><li><a href="https://correial.github.io/Fast Robots/">MAE 4190 Fast Robots</a><li><a href=https://correial.github.io/nexus/>Cornell Nexus</a></ul></details><li><a href=https://correial.github.io/docs/>Docs</a><li id=search><button class=circle id=search-toggle title=Search><i class=icon></i></button><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details></ul></nav><div id=search-container><label class=visually-hidden for=search-bar>Search</label><input placeholder="Search for…" autocomplete=off disabled id=search-bar type=search><div id=search-results-container><div id=search-results></div></div></div></header><main id=main-content><article><div id=heading><p><small> <time datetime=" 2025-03-04T00:00:00+00:00">Published on March 04, 2025</time></small><h1>Lab 4: Motor Drivers and Open Loop Control</h1><p><small><span>4 minutes read</span><span> • </span></small><ul class=tags><li><a class=tag href=https://correial.github.io/tags/robotics/>Robotics</a><li><a class=tag href=https://correial.github.io/tags/c/>C++</a><li><a class=tag href=https://correial.github.io/tags/sensors/>Sensors</a><li><a class=tag href=https://correial.github.io/tags/python/>Python</a><li><a class=tag href=https://correial.github.io/tags/embedded-software/>Embedded Software</a><li><a class=tag href=https://correial.github.io/tags/microcontroller/>Microcontroller</a></ul></div><div id=buttons-container><a title="Go to Top" href=#top id=go-to-top><i class=icon></i></a><a href="https://shareopenly.org/share/?url=https://correial.github.io/Fast Robots/lab-4/" id=share title=Share><i class=icon></i></a></div><h2 id=prelab>Prelab</h2><h3 id=system-wiring-schematic>System Wiring Schematic</h3><p>I decided to use pins <strong>13, A14, A15, A16</strong> for control on the Artemis. This pin proximity does increase risk of shorting connections, however it allows for a more compact design and greater area of the board to be used for mounting to the car rather than having to avoid largely seperated pins. Furthermore, according to the data sheet pins marked with a (~) indicate PWM capability:</p><img alt="Alt text" src="/Fast Robots Media/Lab 4/Artemis Schematic.png" height=450 style=display:block><figcaption>Artemis Schematic</figcaption><p>The diagram for the mtor driver schematic is shown as below:</p><img alt="Alt text" src="/Fast Robots Media/Lab 4/Wiring Schematic.png" style=display:block><figcaption>Drivetrain System Wiring Schematic</figcaption><h3 id=battery-discussion>Battery Discussion</h3><p>The Artemis and the motor drivers/motors are powered by separate batteries to help ensure operational stability, protect components, reduce noise, and increase battery lifetime. The two car motors can act as a disruptive inductive load, potentially creating large amounts of noise and posing a damage risk to sensitive parts. Thus powering the Artemis by a second battery allows the motors to run for longer and protect the Artemis circuit (all connected by signal wires) from the motor interferance and inductive load.<h2 id=lab-tasks>Lab Tasks</h2><h3 id=power-supply-and-oscilloscope-hookup>Power Supply and Oscilloscope Hookup</h3><p>One motor driver was tested at a time by connecting the four <code>OUT</code> pins to the scope while connecting <code>VIN</code> and <code>GND</code> to the power supply to power the driver. The power supply is set to <strong>3.7V</strong> to simulate the 3.7V that would be supplied by the 850mAh motor battery. Below is a picture of the setup (the power supply and oscilloscope probing wires are drawn in to show the setup used to obtain the PWM signal before I soldered the parts to the car):</p><img alt="Alt text" src="/Fast Robots Media/Lab 4/scopepower.png" height=550 style=display:block><figcaption>Scope and Power Supply Connection to Motor Driver</figcaption><p>The following code was used to visualize the motor driver output:<pre class="language-c++ z-code" data-lang=c++><code class=language-c++ data-lang=c++><span class="z-source z-c++"><span class="z-meta z-preprocessor z-macro z-c++"><span class="z-keyword z-control z-import z-define z-c++">#define</span></span><span class="z-meta z-preprocessor z-macro z-c++"> <span class="z-entity z-name z-constant z-preprocessor z-c++">AB1IN_LEFT</span></span><span class="z-meta z-preprocessor z-macro z-c++"> <span class="z-constant z-numeric z-integer z-decimal z-c++">16</span></span>
</span><span class="z-source z-c++"><span class="z-meta z-preprocessor z-macro z-c++"><span class="z-keyword z-control z-import z-define z-c++">#define</span></span><span class="z-meta z-preprocessor z-macro z-c++"> <span class="z-entity z-name z-constant z-preprocessor z-c++">AB2IN_LEFT</span></span><span class="z-meta z-preprocessor z-macro z-c++"> <span class="z-constant z-numeric z-integer z-decimal z-c++">15</span></span>
</span><span class="z-source z-c++">
</span><span class="z-source z-c++"><span class="z-storage z-type z-c">void</span> <span class="z-meta z-function z-c++"><span class="z-meta z-toc-list z-full-identifier z-c++"><span class="z-entity z-name z-function z-c++">setup</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-meta z-function z-c++"> </span><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span></span></span><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++">
</span></span></span><span class="z-source z-c++"><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++">  <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">pinMode</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++">AB1IN_LEFT<span class="z-punctuation z-separator z-c++">,</span>OUTPUT</span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span></span></span><span class="z-source z-c++"><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++">  <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">pinMode</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++">AB2IN_LEFT<span class="z-punctuation z-separator z-c++">,</span>OUTPUT</span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span></span></span><span class="z-source z-c++"><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++"></span></span><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span>
</span><span class="z-source z-c++"><span class="z-storage z-type z-c">void</span> <span class="z-meta z-function z-c++"><span class="z-meta z-toc-list z-full-identifier z-c++"><span class="z-entity z-name z-function z-c++">loop</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-meta z-function z-c++"> </span><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span></span></span><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++">
</span></span></span><span class="z-source z-c++"><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++">  <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">analogWrite</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++">AB1IN_LEFT<span class="z-punctuation z-separator z-c++">,</span><span class="z-constant z-numeric z-integer z-decimal z-c++">100</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span> 
</span></span></span><span class="z-source z-c++"><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++">  <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">analogWrite</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++">AB2IN_LEFT<span class="z-punctuation z-separator z-c++">,</span><span class="z-constant z-numeric z-integer z-decimal z-c++">0</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span></span></span><span class="z-source z-c++"><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++"></span></span><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span>
</span></code></pre><p>The <code>analogWrite(AB1IN_LEFT,100)</code> line indicated a 40% (100/255) duty cycle to pin 16. This was captured on the oscilloscope:</p><img alt="Alt text" src="/Fast Robots Media/Lab 4/scopePWM.jpeg" height=450 style=display:block><figcaption>Oscilloscope PWM Output (40% Duty)</figcaption><h3 id=motor-testing>Motor Testing</h3><h3 id=lower-pwm-limit>Lower PWM Limit</h3><p>I found that the minimum PWM value for which the robot needs to move forward, backward, and on axis by starting with a arbitrary small value and increasing it by 5 until the car no longer stalled but instead moved very slowly. I found that on a fully charged battery the forward and backward lower limit PWD value us <strong>35</strong> and <strong>110</strong> for spinning on axis.<p>Here is a video of testing using those PWM values to go forward, in reverse, then spin on axis in both directions:</p><iframe allowfullscreen height=315 src=https://www.youtube.com/embed/UzNFp05yqZ8 width=450></iframe><figcaption>Lower PWM Limit</figcaption><h3 id=complete-hardware-integration-on-car>Complete Hardware Integration on Car</h3><p>Below are images of the car after mounting all components. Holes were drilled and zip ties were used to strap down the IMU and both motor drivers at the front. Zip ties were also used to bundle the Artemis and 750mAh battery as well as for wire managment. Double sided tape was used to mount the two ToF sensors (one on the side and one at the front) and the Artemis/battery module at the rear.</p><img alt="Alt text" src="/Fast Robots Media/Lab 4/topcar.png" height=400 style=display:block><figcaption>Top of Car</figcaption><div style=justify-content:center;gap:20px;display:flex><div><img alt="Alt text" src="/Fast Robots Media/Lab 4/bottom.jpeg" style=width:auto;max-height:450px><figcaption>Bottom of Car</figcaption></div><div><img alt="Alt text" src="/Fast Robots Media/Lab 4/sidebottom.jpeg" style=width:auto;max-height:450px><figcaption>Battery Connection on Bottom</figcaption></div></div><img alt="Alt text" src="/Fast Robots Media/Lab 4/front.png" height=400 style=display:block><figcaption>Front of Car</figcaption><h3 id=open-loop-testing-and-calibration>Open Loop Testing and Calibration</h3><p>To test a range of car capabilities, I had the car move straight, then in reverse, then rotate on axis in both directions before moving straight left at the end (note each tile is 13“x13“):</p><iframe allowfullscreen height=315 src=https://www.youtube.com/embed/Zv6U8mtepHE width=450></iframe><figcaption>Open Loop Test</figcaption><h3 id=collaboration>Collaboration</h3><p>I collaborated extensively on this project with <a href=https://jack-d-long.github.io/>Jack Long</a> and <a href=https://trevordales.github.io/>Trevor Dales</a>. I referenced <a href=https://mavisfu.github.io/lab3.html>Wenyi’s site</a> for my wiring setup, initial motor control code, and general outline for creating funtions to drive forward, spin right, etc. Special thanks to all TA’s that helped debug my electronics and car for hours before we realized I probably needed a new one!</article><hr><nav id=post-nav><a class="post-nav-item post-nav-prev" href="https://correial.github.io/Fast Robots/lab-3/"> <div class=nav-arrow>Previous</div> <span class=post-title>Lab 3: Time of Flight Sensors</span> </a></nav><span class=hidden id=copy-code-text>Copy Code</span><span class=hidden id=search-index>https://correial.github.io/search_index.en.json</span><span class=hidden id=more-matches-text>$MATCHES more matches</span></main><footer id=site-footer></footer>