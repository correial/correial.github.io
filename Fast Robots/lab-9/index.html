<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#ff7800 name=theme-color><meta content=#ffa348 media=(prefers-color-scheme:dark) name=theme-color><title>Lab 9: Mapping - Home</title><link href="https://correial.github.io/Fast Robots/lab-9/" rel=canonical><link href=https://correial.github.io/favicon.png rel=icon type=image/png><link href=https://correial.github.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link title="Home - RSS Feed" href=https://correial.github.io/rss.xml rel=alternate type=application/rss+xml><link title="Home - Atom Feed" href=https://correial.github.io/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#ff7800}[data-theme=dark]{--accent-color:#ffa348}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#ffa348}}</style><link href=https://correial.github.io/style.css rel=stylesheet><link href=https://correial.github.io/fonts.css rel=stylesheet><link href=https://correial.github.io/katex.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=https://correial.github.io/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://correial.github.io/syntax-theme-dark.css rel=stylesheet><script defer src=https://correial.github.io/closable.js></script><script defer src=https://correial.github.io/copy-button.js></script><script defer src=https://correial.github.io/katex.min.js></script><script defer src=https://correial.github.io/auto-render.min.js></script><script defer src=https://correial.github.io/katex-init.js></script><script defer src=https://correial.github.io/fuse.js></script><script defer src=https://correial.github.io/search-fuse.js></script><script defer src=https://correial.github.io/theme-switcher.js></script><meta content=Home property=og:site_name><meta content="Lab 9: Mapping - Home" property=og:title><meta content="https://correial.github.io/Fast Robots/lab-9/" property=og:url><meta property=og:description><meta content=https://correial.github.io/card.png property=og:image><meta content=en_US property=og:locale><link href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css rel=stylesheet><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js></script><script onload="renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false}
          ],
          displayMode: true
        });" defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js></script><body><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://correial.github.io> <i class=icon></i>Home</a><li class=divider><li><details class=closable><summary>Projects</summary> <ul><li><a href="https://correial.github.io/Fast Robots/">MAE 4190 Fast Robots</a><li><a href=https://correial.github.io/nexus/>Cornell Nexus</a></ul></details><li><a href=https://correial.github.io/docs/>Docs</a><li id=search><button class=circle id=search-toggle title=Search><i class=icon></i></button><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details></ul></nav><div id=search-container><label class=visually-hidden for=search-bar>Search</label><input placeholder="Search for…" autocomplete=off disabled id=search-bar type=search><div id=search-results-container><div id=search-results></div></div></div></header><main id=main-content><article><div id=heading><p><small> <time datetime=" 2025-04-08T00:00:00+00:00">Published on April 08, 2025</time></small><h1>Lab 9: Mapping</h1><p><small><span>8 minutes read</span><span> • </span></small><ul class=tags><li><a class=tag href=https://correial.github.io/tags/robotics/>Robotics</a><li><a class=tag href=https://correial.github.io/tags/c/>C++</a><li><a class=tag href=https://correial.github.io/tags/sensors/>Sensors</a><li><a class=tag href=https://correial.github.io/tags/python/>Python</a><li><a class=tag href=https://correial.github.io/tags/embedded-software/>Embedded Software</a><li><a class=tag href=https://correial.github.io/tags/microcontroller/>Microcontroller</a></ul></div><div id=buttons-container><a title="Go to Top" href=#top id=go-to-top><i class=icon></i></a><a href="https://shareopenly.org/share/?url=https://correial.github.io/Fast Robots/lab-9/" id=share title=Share><i class=icon></i></a></div><h2 id=orientation-control-implementation>Orientation Control Implementation</h2><p>Orientation control via the IMU’s DMP library was used to set target angles for ToF data collection. With success and high accuracy using the DMP in Lab 6, I figured that this was the best approach to ensure that the robot was reliably turning a set number of degrees throughout its rotation.<h3 id=ble-and-data-transmission>BLE and Data Transmission</h3><p>The <code>SPIN</code> case handled initiating and running the turning logic as well as sending data over BLE at the end of collection. The case was called over bluetooth via the command: <code>ble.send_command(CMD.SPIN, "4.6|0|0")</code>. The parameters are used to pass through PID gains for more efficient tuning and are ordered as follows: Kp|Ki|Kd. I found that with the small changes in target angles, and the goal of moving fairly slow, that only proportional control was needed to reliably come within a degree or two of the target. At the slow speeds, there was minimal, if any, overshoot thus a derivative term was not needed. A notification handler is used to recieve the data and help pipe it into CSV files as used in previous labs.<h3 id=arduino-implementation>Arduino Implementation</h3><p>The <code>SPIN</code> code is shown below. The robot spins a full 360 degrees; this is broken up into 12 degrees per movement every two seconds for a total of <strong>30 rotations</strong>. The next target angle (adding 12 to <code>target_turn</code>) is set every two seconds to allow for ample data collection time at a fixed angle for maximum ToF accuracy. Note that I have have ToF sensors collecting data at all times to increase the number of data points. While this does come at the cost of decreased accuracy while rotating between each two second break, it did not seem to greatly impact the ToF readings and the increased resultion was well worth the slightly decreased accuracy at a few points. Roughly 2780 ToF readings were collected per full rotation (not all necessarily unique).<pre class="language-c++ z-code" data-lang=c++><code class=language-c++ data-lang=c++><span class="z-source z-c++">distanceSensor1<span class="z-punctuation z-accessor z-dot z-c++">.</span><span class="z-meta z-method-call z-c++"><span class="z-variable z-function z-member z-c++">startRanging</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-method-call z-c++"></span><span class="z-meta z-method-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span><span class="z-source z-c++">success <span class="z-keyword z-operator z-assignment z-c">=</span> robot_cmd<span class="z-punctuation z-accessor z-dot z-c++">.</span><span class="z-meta z-method-call z-c++"><span class="z-variable z-function z-member z-c++">get_next_value</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-method-call z-c++"><span class="z-meta z-group z-c++">Kp_turn</span></span><span class="z-meta z-method-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span><span class="z-source z-c++"><span class="z-keyword z-control z-c++">if</span> <span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span><span class="z-keyword z-operator z-arithmetic z-c">!</span>success<span class="z-punctuation z-section z-group z-end z-c++">)</span></span> <span class="z-keyword z-control z-flow z-return z-c++">return</span><span class="z-punctuation z-terminator z-c++">;</span>
</span><span class="z-source z-c++"><span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> Same for Ki and Kd
</span></span><span class="z-source z-c++">
</span><span class="z-source z-c++"><span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> Time varaibles
</span></span><span class="z-source z-c++">spin_time <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">millis</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span><span class="z-source z-c++">start_time_pid_turn <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">millis</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span><span class="z-source z-c++">last_rotation_time <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">millis</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span><span class="z-source z-c++">
</span><span class="z-source z-c++"><span class="z-keyword z-control z-c++">while</span> <span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span>spin_counter <span class="z-keyword z-operator z-comparison z-c"><</span> spin_len<span class="z-punctuation z-section z-group z-end z-c++">)</span></span> <span class="z-keyword z-operator z-arithmetic z-c">&&</span> <span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span>rot_counter <span class="z-keyword z-operator z-comparison z-c"><=</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">30</span><span class="z-punctuation z-section z-group z-end z-c++">)</span></span><span class="z-punctuation z-section z-group z-end z-c++">)</span></span> <span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span>
</span></span><span class="z-source z-c++"><span class="z-meta z-block z-c++">  <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">getDMP</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span></span><span class="z-source z-c++"><span class="z-meta z-block z-c++">  <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">runPIDRot</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span></span><span class="z-source z-c++"><span class="z-meta z-block z-c++">  <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">collectTOF</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span></span><span class="z-source z-c++"><span class="z-meta z-block z-c++">  spinTime<span class="z-meta z-brackets z-c++"><span class="z-punctuation z-section z-brackets z-begin z-c++">[</span>spin_counter<span class="z-punctuation z-section z-brackets z-end z-c++">]</span></span> <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">millis</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span> <span class="z-keyword z-operator z-arithmetic z-c">-</span> spin_time<span class="z-punctuation z-terminator z-c++">;</span>
</span></span><span class="z-source z-c++"><span class="z-meta z-block z-c++">  
</span></span><span class="z-source z-c++"><span class="z-meta z-block z-c++">  elapsed_time <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">millis</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span> <span class="z-keyword z-operator z-arithmetic z-c">-</span> last_rot_time<span class="z-punctuation z-terminator z-c++">;</span>
</span></span><span class="z-source z-c++"><span class="z-meta z-block z-c++">  <span class="z-keyword z-control z-c++">if</span> <span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span>elapsed_time <span class="z-keyword z-operator z-comparison z-c">></span> <span class="z-constant z-numeric z-integer z-decimal z-c++">2000</span><span class="z-punctuation z-section z-group z-end z-c++">)</span></span> <span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span>
</span></span></span><span class="z-source z-c++"><span class="z-meta z-block z-c++"><span class="z-meta z-block z-c++">    last_rot_time <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">millis</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span></span></span><span class="z-source z-c++"><span class="z-meta z-block z-c++"><span class="z-meta z-block z-c++">    rot_counter <span class="z-keyword z-operator z-assignment z-c">=</span> rot_counter <span class="z-keyword z-operator z-arithmetic z-c">+</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">1</span><span class="z-punctuation z-terminator z-c++">;</span>
</span></span></span><span class="z-source z-c++"><span class="z-meta z-block z-c++"><span class="z-meta z-block z-c++">    target_turn <span class="z-keyword z-operator z-assignment z-c">=</span> target_turn <span class="z-keyword z-operator z-arithmetic z-c">+</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">12</span><span class="z-punctuation z-terminator z-c++">;</span>
</span></span></span><span class="z-source z-c++"><span class="z-meta z-block z-c++"><span class="z-meta z-block z-c++">  <span class="z-punctuation z-section z-block z-end z-c++">}</span></span>   
</span></span><span class="z-source z-c++"><span class="z-meta z-block z-c++">    spin_counter <span class="z-keyword z-operator z-assignment z-c">=</span> spin_counter <span class="z-keyword z-operator z-arithmetic z-c">+</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">1</span><span class="z-punctuation z-terminator z-c++">;</span>
</span></span><span class="z-source z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span>
</span><span class="z-source z-c++"><span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">stop</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span><span class="z-source z-c++"><span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">sendPIDTURNData</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span><span class="z-source z-c++"><span class="z-keyword z-control z-flow z-break z-c++">break</span><span class="z-punctuation z-terminator z-c++">;</span>
</span></code></pre><p>There are a few important functions to note, many of which have been used in my previous labs:<ul><li><code>getDMP()</code> is responsible for updating the global yaw array with the current angle reading<li><code>collectTOF()</code> updates the global ToF arrays with the current ToF readings regardless if whether a new one is ready<li><code>sendPIDTURNData()</code> is responsible for sending over all relevant arrays over BLE<li><code>runPIDRot()</code> (<em>shown below</em>) is responsible for handling all rotational PID logic–it passes in the gains, target, and current angle into the <code>pid_turn_Gyro()</code> function which is explained in detail in Lab 6</ul><pre class="language-c++ z-code" data-lang=c++><code class=language-c++ data-lang=c++><span class="z-source z-c++">timesROT<span class="z-meta z-brackets z-c++"><span class="z-punctuation z-section z-brackets z-begin z-c++">[</span>counter_turn<span class="z-punctuation z-section z-brackets z-end z-c++">]</span></span> <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">millis</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span> <span class="z-keyword z-operator z-arithmetic z-c">-</span> start_time_pid_turn<span class="z-punctuation z-terminator z-c++">;</span>
</span><span class="z-source z-c++">
</span><span class="z-source z-c++">  curDistance_turn <span class="z-keyword z-operator z-assignment z-c">=</span> yaw_gy<span class="z-punctuation z-terminator z-c++">;</span>
</span><span class="z-source z-c++">
</span><span class="z-source z-c++">  pidTurn_speed<span class="z-meta z-brackets z-c++"><span class="z-punctuation z-section z-brackets z-begin z-c++">[</span>counter_turn<span class="z-punctuation z-section z-brackets z-end z-c++">]</span></span> <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">pid_turn_Gyro</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++">Kp_turn<span class="z-punctuation z-separator z-c++">,</span> Ki_turn<span class="z-punctuation z-separator z-c++">,</span> Kd_turn<span class="z-punctuation z-separator z-c++">,</span> curDistance_turn<span class="z-punctuation z-separator z-c++">,</span> target_turn</span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
</span><span class="z-source z-c++">
</span><span class="z-source z-c++">  pidTurn_p<span class="z-meta z-brackets z-c++"><span class="z-punctuation z-section z-brackets z-begin z-c++">[</span>counter_turn<span class="z-punctuation z-section z-brackets z-end z-c++">]</span></span> <span class="z-keyword z-operator z-assignment z-c">=</span> Kp_turn <span class="z-keyword z-operator z-c">*</span> pos_error_turn<span class="z-punctuation z-terminator z-c++">;</span>
</span><span class="z-source z-c++">  <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> Same array populating for propotional, derivative, LPF derivative, and integral terms
</span></span><span class="z-source z-c++">
</span><span class="z-source z-c++">  counter_turn <span class="z-keyword z-operator z-assignment z-c">=</span> counter_turn <span class="z-keyword z-operator z-arithmetic z-c">+</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">1</span><span class="z-punctuation z-terminator z-c++">;</span>
</span></code></pre><h2 id=on-axis-rotation-testing>On-Axis Rotation Testing</h2><h3 id=drift-error>Drift Error</h3><p>I set up a 1ft by 1ft square with a ruler in frame to test the drift of the robot over the course of the 360 degree scan. From the video you can see that the drift throughout mapping was roughly three inches likely due to wheel slip, ground friction despite wheel tape, and an inbalance of motor power. In a 4×4 meter room, this drift would not accumulate fully in one direction, but rather we can asume that it averages out across the scan point. As a result, the expected average positional error in the final map would be roughly <strong>1.5 inches (3.8 cm)</strong>. This results in a worst-case error under 1%, which is acceptable for an empty 4×4 m room. While I tried to use correction terms to reduce the drift, I was not able to completely mitigate it.</p><iframe allowfullscreen height=315 src=https://www.youtube.com/embed/R_70C47RUNE width=450></iframe><figcaption>360° On-Axis Test</figcaption><h3 id=data-for-target-setting>Data for Target Setting</h3><p>Note you can see that for roughly 2/3 of rotations, there was no overshoot as a reverse correction input was not needed (seen on the below graph). For instances of small overshoots, they were quickly corrected as seen from a spike in speed in the opposite direction. If I wanted to completely eliminate these overshoots, I would have to make the rotations slower. This results in a memory overflow issue. The 12 degree timing every two seconds comes very close to maxing out the dynamic memory on the Artemis.</p><img alt="Alt text" src="/Fast Robots Media/Lab 9/RotPIDControl.png" style=display:block><figcaption>Rotational PID and Target Setting</figcaption><h2 id=mapping-data-and-post-processing>Mapping Data and Post Processing</h2><h3 id=360-scan-at-global-coordinates>360 Scan at Global Coordinates</h3><p>For all runs, the robot was started at zero degrees facing the same way as shown in the video. The video shows a full ToF sweep taken at the coordinate (0,3)</p><iframe allowfullscreen height=315 src=https://www.youtube.com/embed/HBY2xBkobXg width=450></iframe><figcaption>360° Data Collection Scan</figcaption><p>The data at each coordinate was then graphed on a polar plot for an initial sanity check</p><img alt="Alt text" src="/Fast Robots Media/Lab 9/MapPoints.png" style=display:block><figcaption>Mapping Scans</figcaption><h3 id=transformation-matrices>Transformation Matrices</h3><img alt="Alt text" src="/Fast Robots Media/Lab 9/Coordinates.png" height=350 style=display:block><figcaption>Robot Coordinate System</figcaption><p>A few transformations were used to convert the raw ToF data into the global arena coordinate system. I started by taking into account the front ToF sensor location relative to the robot’s center via the robot’s coordinate axis (shown above). I found that the ToF sensor (“TOF” in the matrix) is positioned 70 mm $\hat{x}$, 0 mm $\hat{y}$ from the robots center.<p>The following position vector is yielded<div id=math-p1></div><script>document.addEventListener("DOMContentLoaded", function () {
    katex.render(String.raw`
      P_1 =
      \begin{bmatrix}
        \mathrm{TOF} \\[0.2em]
        0 \\[0.2em]
        1
      \end{bmatrix}
    `, document.getElementById("math-p1"), {
      displayMode: true
    });
  });</script><p>Next, a transformation is needed to convert the robot’s local angular yaw coordinate (from the DMP) to global $\hat{x}$ and $\hat{y}$ coordinates<div id=math-rotz></div><script>document.addEventListener("DOMContentLoaded", function () {
    katex.render(String.raw`
      R_z(\theta) =
      \begin{bmatrix}
        \cos\theta & -\sin\theta & x \\[0.2em]
        \sin\theta & \cos\theta & y \\[0.2em]
        0 & 0 & 1
      \end{bmatrix}
    `, document.getElementById("math-rotz"), {
      displayMode: true
    });
  });</script><h3 id=map>Map</h3><p>After the transformations are applied to the raw ToF and DMP data, the following map is created</p><img alt="Alt text" src="/Fast Robots Media/Lab 9/OGMap.png" style=display:block><figcaption>ToF Arena Map</figcaption><p>The blue arc in the middle of the arena likely indicates that a new ToF reading was not recieved for a few degrees of rotation, essentially creating part of a circle as the same ToF value is being plotted for a small sweep of angles. Additionally straight lines in the middle of the map are likely due to sensor noise as they appear in every trial.<h3 id=line-based-map-conversion>Line-Based Map Conversion</h3><p>I estimated the arena walls from the ToF map and overlayed it onto the graph. Note that some of the estimated walls appear slanted. This may be the result of a block being slightly angled at the time of data collection. The dotted black line represents the estimated arena from the ToF values</p><img alt="Alt text" src="/Fast Robots Media/Lab 9/MapwEstimates.png" style=display:block><figcaption>ToF Arena Map with Estimated Lines and True Map</figcaption><p>The following start and end arrays were used to create the estimated arena map (dotted black line above)<pre class="language-python z-code" data-lang=python><code class=language-python data-lang=python><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">starts</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-sequence z-list z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">[</span><span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">5<span class="z-punctuation z-separator z-decimal z-python">.</span>09</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>43</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">5<span class="z-punctuation z-separator z-decimal z-python">.</span>09</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>43</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>45</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>2</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>33</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">2<span class="z-punctuation z-separator z-decimal z-python">.</span>30</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>98</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">2<span class="z-punctuation z-separator z-decimal z-python">.</span>30</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">1<span class="z-punctuation z-separator z-decimal z-python">.</span>15</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>27</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">6<span class="z-punctuation z-separator z-decimal z-python">.</span>56</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>10</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">6<span class="z-punctuation z-separator z-decimal z-python">.</span>40</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>5</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">2<span class="z-punctuation z-separator z-decimal z-python">.</span>13</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>5</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">2<span class="z-punctuation z-separator z-decimal z-python">.</span>13</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>33</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">2<span class="z-punctuation z-separator z-decimal z-python">.</span>45</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-constant z-numeric z-float z-decimal z-python">1<span class="z-punctuation z-separator z-decimal z-python">.</span>64</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>7</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-constant z-numeric z-float z-decimal z-python">1<span class="z-punctuation z-separator z-decimal z-python">.</span>64</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span><span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>7</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>75</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">2<span class="z-punctuation z-separator z-decimal z-python">.</span>45</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>75</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-section z-sequence z-end z-python">]</span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">ends</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-sequence z-list z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">[</span><span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">5<span class="z-punctuation z-separator z-decimal z-python">.</span>09</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>33</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>45</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>2</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>45</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">2<span class="z-punctuation z-separator z-decimal z-python">.</span>30</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>98</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">2<span class="z-punctuation z-separator z-decimal z-python">.</span>30</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span><span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">1<span class="z-punctuation z-separator z-decimal z-python">.</span>15</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>27</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">6<span class="z-punctuation z-separator z-decimal z-python">.</span>56</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>10</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">6<span class="z-punctuation z-separator z-decimal z-python">.</span>40</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>5</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">2<span class="z-punctuation z-separator z-decimal z-python">.</span>13</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>5</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">2<span class="z-punctuation z-separator z-decimal z-python">.</span>13</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>33</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">5<span class="z-punctuation z-separator z-decimal z-python">.</span>09</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>33</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>7</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-constant z-numeric z-float z-decimal z-python">1<span class="z-punctuation z-separator z-decimal z-python">.</span>64</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">4<span class="z-punctuation z-separator z-decimal z-python">.</span>7</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>75</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">2<span class="z-punctuation z-separator z-decimal z-python">.</span>45</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-keyword z-operator z-arithmetic z-python">-</span><span class="z-constant z-numeric z-float z-decimal z-python">0<span class="z-punctuation z-separator z-decimal z-python">.</span>75</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-meta z-sequence z-tuple z-python"><span class="z-punctuation z-section z-sequence z-begin z-python">(</span><span class="z-constant z-numeric z-float z-decimal z-python">2<span class="z-punctuation z-separator z-decimal z-python">.</span>45</span><span class="z-punctuation z-separator z-sequence z-python">,</span> <span class="z-constant z-numeric z-float z-decimal z-python">1<span class="z-punctuation z-separator z-decimal z-python">.</span>64</span><span class="z-punctuation z-section z-sequence z-end z-python">)</span></span><span class="z-punctuation z-section z-sequence z-end z-python">]</span></span>
</span></code></pre><h3 id=true-map>True Map</h3><div style=margin-bottom:10px>I also added the true map of the arena (in purple) knowing that every tile is 1ft x 1ft</div><div style=justify-content:center;align-items:flex-start;gap:20px;margin-top:0;padding-top:0;display:flex><figure style=text-align:center;margin:0><img alt="ToF Arena Map 1" src="/Fast Robots Media/Lab 9/MapwLines.png" style=width:auto;height:300px><figcaption style=margin-top:5px>ToF Arena Map with Estimated Lines and True Map</figcaption></figure><figure style=text-align:center;margin:0><img alt="ToF Arena Map 2" src="/Fast Robots Media/Lab 9/MapIRL.jpeg" style=width:auto;height:300px><figcaption style=margin-top:5px>ToF Arena Map with Estimated Lines and True Map</figcaption></figure></div><p>You can see that the fit between the estimated and true map are fairly close; the largest deviations appear to be at the center box and protruding wall at th bottom center. Again, I would say that this is mostly the result of ToF noise as it is constantly changing the distance away from the wall that it is seeing. Noise is especially evident when the robot is pointed at relatively far walls.<h2 id=collaboration>Collaboration</h2><p>I collaborated extensively on this project with <a href=https://jack-d-long.github.io/>Jack Long</a> and <a href=https://trevordales.github.io/>Trevor Dales</a>. ChatGPT was used to help plot and format graphs.</article><hr><nav id=post-nav><a class="post-nav-item post-nav-prev" href="https://correial.github.io/Fast Robots/lab-8/"> <div class=nav-arrow>Previous</div> <span class=post-title>Lab 8: Stunts</span> </a><a class="post-nav-item post-nav-next" href="https://correial.github.io/Fast Robots/lab-10/"> <div class=nav-arrow>Next</div> <span class=post-title>Lab 10: Grid Localization using Bayes Filter</span> </a></nav><span class=hidden id=copy-code-text>Copy Code</span><span class=hidden id=search-index>https://correial.github.io/search_index.en.json</span><span class=hidden id=more-matches-text>$MATCHES more matches</span></main><footer id=site-footer></footer>